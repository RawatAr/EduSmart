<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <title th:text="${course.title} + ' - EduSmart'">Course Detail - EduSmart</title>
</head>
<body>
    <div layout:fragment="content">
        <!-- Course Header -->
        <section class="bg-primary text-white py-5">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-lg-8">
                        <div class="d-flex align-items-center mb-3">
                            <span class="badge bg-light text-primary me-3" th:text="${course.categoryName}"></span>
                            <div class="d-flex align-items-center">
                                <i class="bi bi-star-fill text-warning me-1"></i>
                                <span>4.5 (120 reviews)</span>
                            </div>
                        </div>
                        <h1 class="display-5 fw-bold mb-3" th:text="${course.title}"></h1>
                        <p class="lead mb-4" th:text="${course.description}"></p>

                        <div class="d-flex align-items-center mb-4">
                            <img src="https://via.placeholder.com/50x50/007bff/ffffff?text=I"
                                 alt="Instructor" class="rounded-circle me-3">
                            <div>
                                <h6 class="mb-0" th:text="${course.instructorName}"></h6>
                                <small class="text-light">Course Instructor</small>
                            </div>
                        </div>

                        <div class="row g-4 mb-4">
                            <div class="col-auto">
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-clock me-2"></i>
                                    <span>8 weeks duration</span>
                                </div>
                            </div>
                            <div class="col-auto">
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-people me-2"></i>
                                    <span th:text="${enrollmentCount} + ' students enrolled'"></span>
                                </div>
                            </div>
                            <div class="col-auto">
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-globe me-2"></i>
                                    <span>English</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-4">
                        <div class="card shadow">
                            <div class="card-body text-center">
                                <img src="https://via.placeholder.com/300x200/007bff/ffffff?text=Course+Image"
                                     alt="Course Preview" class="img-fluid rounded mb-3">

                                <div sec:authorize="!isAuthenticated()">
                                    <p class="text-muted mb-3">Sign in to enroll in this course</p>
                                    <a href="/login" class="btn btn-primary w-100 mb-2">
                                        <i class="bi bi-box-arrow-in-right me-2"></i>Sign In to Enroll
                                    </a>
                                    <a href="/register" class="btn btn-outline-primary w-100">
                                        Create Account
                                    </a>
                                </div>

                                <div sec:authorize="isAuthenticated()" th:if="${!isEnrolled}">
                                    <div class="mb-3">
                                        <h4 class="text-success mb-0">Free</h4>
                                        <small class="text-muted">Lifetime access</small>
                                    </div>
                                    <form th:action="@{/enrollments}" method="post">
                                        <input type="hidden" name="courseId" th:value="${course.id}">
                                        <button type="submit" class="btn btn-success w-100 mb-2">
                                            <i class="bi bi-plus-circle me-2"></i>Enroll Now
                                        </button>
                                    </form>
                                    <button class="btn btn-outline-primary w-100">
                                        <i class="bi bi-heart me-2"></i>Add to Wishlist
                                    </button>
                                </div>

                                <div sec:authorize="isAuthenticated()" th:if="${isEnrolled}">
                                    <div class="alert alert-success mb-3">
                                        <i class="bi bi-check-circle me-2"></i>
                                        You're enrolled in this course!
                                    </div>
                                    <a th:href="@{/courses/{id}/learn(id=${course.id})}"
                                       class="btn btn-primary w-100 mb-2">
                                        <i class="bi bi-play-circle me-2"></i>Continue Learning
                                    </a>
                                    <div class="text-start">
                                        <small class="text-muted">Progress: <span th:text="${progressPercentage} + '%'"></span></small>
                                        <div class="progress mt-1" style="height: 6px;">
                                            <div class="progress-bar bg-primary"
                                                 th:style="'width: ' + ${progressPercentage} + '%'"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Course Content -->
        <section class="py-5">
            <div class="container">
                <div class="row">
                    <!-- Main Content -->
                    <div class="col-lg-8">
                        <!-- Course Overview -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5 class="mb-0">Course Overview</h5>
                            </div>
                            <div class="card-body">
                                <p th:text="${course.content}"></p>
                            </div>
                        </div>

                        <!-- What You'll Learn -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5 class="mb-0">What You'll Learn</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <ul class="list-unstyled">
                                            <li class="mb-2"><i class="bi bi-check-circle text-success me-2"></i>Master core concepts</li>
                                            <li class="mb-2"><i class="bi bi-check-circle text-success me-2"></i>Hands-on projects</li>
                                            <li class="mb-2"><i class="bi bi-check-circle text-success me-2"></i>Real-world applications</li>
                                        </ul>
                                    </div>
                                    <div class="col-md-6">
                                        <ul class="list-unstyled">
                                            <li class="mb-2"><i class="bi bi-check-circle text-success me-2"></i>Interactive assessments</li>
                                            <li class="mb-2"><i class="bi bi-check-circle text-success me-2"></i>Discussion forums</li>
                                            <li class="mb-2"><i class="bi bi-check-circle text-success me-2"></i>Certificate of completion</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Course Content/Curriculum -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5 class="mb-0">Course Content</h5>
                            </div>
                            <div class="card-body">
                                <div class="accordion" id="courseCurriculum">
                                    <div class="accordion-item" th:each="lesson, iterStat : ${lessons}">
                                        <h2 class="accordion-header">
                                            <button class="accordion-button"
                                                    type="button"
                                                    data-bs-toggle="collapse"
                                                    th:data-bs-target="'#lesson' + ${iterStat.index}"
                                                    th:aria-controls="'lesson' + ${iterStat.index}">
                                                <span th:text="'Lesson ' + ${iterStat.count} + ': ' + ${lesson.title}"></span>
                                                <span class="badge bg-primary ms-2">15 min</span>
                                            </button>
                                        </h2>
                                        <div th:id="'lesson' + ${iterStat.index}"
                                             class="accordion-collapse collapse"
                                             th:classappend="${iterStat.first} ? 'show'">
                                            <div class="accordion-body">
                                                <p th:text="${lesson.description}"></p>
                                                <div class="d-flex justify-content-between align-items-center">
                                                    <small class="text-muted">Video • Quiz • Resources</small>
                                                    <span sec:authorize="isAuthenticated()" th:if="${isEnrolled}">
                                                        <a th:href="@{/courses/{courseId}/lessons/{lessonId}/learn(courseId=${course.id}, lessonId=${lesson.id})}"
                                                           class="btn btn-sm btn-outline-primary">
                                                            <i class="bi bi-play me-1"></i>Start Lesson
                                                        </a>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Reviews -->
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Student Reviews</h5>
                            </div>
                            <div class="card-body">
                                <div class="review-item mb-3" th:each="review : ${reviews}">
                                    <div class="d-flex">
                                        <img src="https://via.placeholder.com/40x40/6c757d/ffffff?text=S"
                                             alt="Student" class="rounded-circle me-3">
                                        <div class="flex-grow-1">
                                            <div class="d-flex justify-content-between align-items-start mb-2">
                                                <h6 class="mb-0" th:text="${review.studentName}"></h6>
                                                <div class="d-flex align-items-center">
                                                    <div class="me-2">
                                                        <i class="bi bi-star-fill text-warning" th:each="star : ${#numbers.sequence(1, review.rating)}"></i>
                                                    </div>
                                                    <small class="text-muted" th:text="${review.date}"></small>
                                                </div>
                                            </div>
                                            <p class="mb-0" th:text="${review.comment}"></p>
                                        </div>
                                    </div>
                                </div>

                                <div class="text-center mt-3">
                                    <button class="btn btn-outline-primary">Load More Reviews</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sidebar -->
                    <div class="col-lg-4">
                        <!-- Course Stats -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <h6 class="mb-0">Course Statistics</h6>
                            </div>
                            <div class="card-body">
                                <div class="d-flex justify-content-between mb-2">
                                    <span>Enrollments</span>
                                    <strong th:text="${enrollmentCount}"></strong>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span>Completion Rate</span>
                                    <strong>85%</strong>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span>Average Rating</span>
                                    <strong>4.5 ★</strong>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span>Last Updated</span>
                                    <strong>2 weeks ago</strong>
                                </div>
                            </div>
                        </div>

                        <!-- Instructor Info -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <h6 class="mb-0">About the Instructor</h6>
                            </div>
                            <div class="card-body text-center">
                                <img src="https://via.placeholder.com/80x80/007bff/ffffff?text=I"
                                     alt="Instructor" class="rounded-circle mb-3">
                                <h6 th:text="${course.instructorName}"></h6>
                                <p class="text-muted small mb-3">
                                    Experienced educator with 10+ years of teaching experience
                                    in software development and interactive learning.
                                </p>
                                <div class="d-flex justify-content-center gap-3 text-muted">
                                    <span><i class="bi bi-star-fill text-warning"></i> 4.8</span>
                                    <span><i class="bi bi-people"></i> 15k students</span>
                                    <span><i class="bi bi-book"></i> 25 courses</span>
                                </div>
                            </div>
                        </div>

                        <!-- Related Courses -->
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0">Related Courses</h6>
                            </div>
                            <div class="card-body">
                                <div class="related-course mb-3" th:each="relatedCourse : ${relatedCourses}">
                                    <div class="d-flex">
                                        <img src="https://via.placeholder.com/60x40/6c757d/ffffff?text=C"
                                             alt="Course" class="me-3 rounded">
                                        <div>
                                            <h6 class="mb-1 small" th:text="${relatedCourse.title}"></h6>
                                            <small class="text-muted" th:text="${relatedCourse.instructorName}"></small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <div layout:fragment="scripts">
        <script>
            // Course detail page interactivity
            document.addEventListener('DOMContentLoaded', function() {
                // Initialize tooltips
                const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
                const tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                    return new bootstrap.Tooltip(tooltipTriggerEl);
                });

                // Enrollment button animation
                const enrollBtn = document.querySelector('.btn-success');
                if (enrollBtn) {
                    enrollBtn.addEventListener('mouseenter', function() {
                        this.innerHTML = '<i class="bi bi-lightning-charge me-2"></i>Get Started Now!';
                    });

                    enrollBtn.addEventListener('mouseleave', function() {
                        this.innerHTML = '<i class="bi bi-plus-circle me-2"></i>Enroll Now';
                    });
                }

                // Progress bar animation
                const progressBars = document.querySelectorAll('.progress-bar');
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            entry.target.style.transition = 'width 1s ease-in-out';
                        }
                    });
                });

                progressBars.forEach(bar => observer.observe(bar));
            });
        </script>
    </div>
</body>
</html>